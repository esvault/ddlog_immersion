# Pacemaker with DDlog

В этой папке представлен пример использования декларативного языка программирования, поддерживающего инкрементальные вычисления, [DDlog](https://github.com/vmware/differential-datalog) для примениния ограничений в менеджере отказоустойчивых кластеров [Pacemaker](https://github.com/ClusterLabs/pacemaker).

## Подготовка окружения и запуск

В первую очередь необходимо установить DDlog. Процесс установки подробно расписан в этом [документе](https://github.com/vmware/differential-datalog/blob/master/README.md#Installation). Для запуска программы используется скрипт [run.sh](/pcmkr/run.sh). Он запускает ddlog promt, через который происходит обновление данных в DDlog. 

Если запустить скрипт с опцией `-b`, то он перекомпилирует исходный код. Для удобства можно подготовить необходимый вход для программы и записать его в файл, который можно передать при помощи перенаправления стандартного потока ввода:
`./run.sh -b < data.dat` 

## Структура проекта

- `prog.dl` --- основная программа на языке DDlog
- `data.dat` --- набор входных данных для демонстрации работоспособности
- `run.sh` --- скрипт для компиляции и запуска
- `sched_io` --- содержит cib (вход для планировщика pacemaker) и представления графа действий до и после обновлений


## Результаты

Вход программы --- файл `data.dat`, написан вручную при помощи `sched_io/before_updating.svg` и логов, однако его можно научиться генерировать. Вывод программы:

```
EdgesToDelete:
EdgesToDelete{.from = 11, .to = 19}: +1
EdgesToDelete{.from = 17, .to = 9}: +1
EdgesToInsert:
EdgesToInsert{.from = 12, .to = 19}: +1
EdgesToInsert{.from = 13, .to = 5}: +1
EdgesToInsert{.from = 15, .to = 7}: +1
EdgesToInsert{.from = 18, .to = 9}: +1
```

В графе действий после обновлений `sched_io/after_updating.svg` добавлены и удалены перечисленные ребра.